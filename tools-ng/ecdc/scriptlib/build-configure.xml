<?xml version="1.0" encoding="UTF-8"?>

<project name="configure" default="configure">

    <!--  ALREADY SET in build.xml . Wrong here!
	<property name="project.dir" value="." />
    -->

    <!-- Already imported in build.xml which imports this file  -->
	<!--  <import file="${tools.script.dir}/build-common.xml" />  -->

	<target name="configure">
		<echo>Validating the schema of project.xml</echo>
			
		<!-- http://xerces.apache.org/xerces2-j/samples-dom.html#Counter -->
		<java classname="dom.Counter" classpathref="tools.classpath"
              errorproperty="project.validation.errors"
			  outputproperty="project.validation.output">
			<arg value="-s" />
			<arg value="-f" />
			<arg value="-v" />
			<arg value="${project.dir}/project.xml" />
		</java>
		<if>
			<bool>
				<not>
					<equals arg1="${project.validation.errors}" arg2="" />
				</not>
			</bool>
			<fail message="${project.validation.errors}" />
		</if>
						
		<!--  Building .ccm.classpath for eclipse IDE -->
		<!-- 
		<echo message="Regenerating .classpath" />
		<xslt style="${tools.xsl.dir}/eclipse-classpath-template.xsl"
              in="project.xml" out=".classpath"
		      classpathref="tools.classpath" force="yes">
			<param name="base.dir" expression="${project.dir}" />
			<param name="shared.lib.dist.dir" expression="${tools.lib.dir}" />
		</xslt>
		-->

		<!-- Building the core: build-projects.xml from projects.xml with all
             targets for compile / build / deploy
		     uses currently the xsl templates used by the ccm scripts 							-->
		<echo message="Regenerating build-projects.xml" />
		<xslt style="${tools.xsl.dir}/combine.xsl" in="project.xml"
              out=".tmp.project.xml" classpathref="tools.classpath" force="yes" />
		<xslt style="${tools.xsl.dir}/build-template.xsl" in=".tmp.project.xml"
              out="build-projects.xml" classpathref="tools.classpath" force="yes" />
		<delete file=".tmp.project.xml"/>
			
		<!-- Building ccm.classpath which used to contain a list with dirs 
             to include into the classpath  for each module included in the
             project (~/build/classes ~/build/sql ~/lib ~/pdl )              -->
		<!--
		<xslt style="${tools.xsl.dir}/classpath-template.xsl" in="project.xml"
              out="ccm.classpath" classpathref="tools.classpath" force="yes">
			<param name="base.dir" expression="${project.dir}" />
			<param name="shared.lib.dist.dir" expression="${tools.lib.dir}" />
		</xslt>
		-->
	</target>

</project>
