#!/bin/bash

set -x

if [ -z "$CCM_HOME" ]
then
  return 1
fi

# System values
[ -f "/etc/ccm/ccm.conf" ] && . "/etc/ccm/ccm.conf"

# Optional server-specific values
[ -f "$CCM_HOME/conf/ccm.conf" ] && . "$CCM_HOME/conf/ccm.conf"

if [ -z "$CCM_CLASSPATH" ]
then

  CCM_CLASSPATH="$CCM_CLASSPATH_CUSTOM"

  for dir in `ls -d $CCM_HOME/conf/*`
  do
    CCM_CLASSPATH=$CCM_CLASSPATH:$dir
  done

  if [ -n "$CCM_APPS" ]
  then
    for APP in $CCM_APPS
    do
      [ -f "/usr/share/java/$APP.jar" ] && CCM_CLASSPATH="$CCM_CLASSPATH:/usr/share/java/$APP.jar"
      if [ -d "/usr/share/java/$APP" ]
      then
        for file in `ls /usr/share/java/$APP`
        do
          CCM_CLASSPATH=$CCM_CLASSPATH:/usr/share/java/$APP/$file
        done
      fi
    done
  else
    echo foo
  fi
fi

CCM_CLASSPATH=`echo $CCM_CLASSPATH | sed -e 's/::/:/g' | sed -e 's/:$//' | sed -e 's/^://'`

echo $CCM_CLASSPATH | tr : "\n"

java -cp $CCM_CLASSPATH -Dccm.home=$CCM_HOME "$@"
